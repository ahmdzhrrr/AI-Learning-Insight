info:
  title: AI Learning Insight API (with ML)
  description: >
    RESTful API untuk aplikasi AI Learning Insight.
    Mendukung JWT auth, manajemen metrics (10 fitur perilaku belajar),
    dan integrasi FastAPI ML service untuk prediksi gaya belajar.
  version: 1.0.0

servers:
  - url: http://localhost:5000

paths:

  /auth/login:
    post:
      summary: Login untuk mendapatkan token JWT
      requestBody:
        required: true
        content:
          application/json:
            example:
              email: "nrizki@dicoding.com"
              password: "12345"
      responses:
        "200":
          description: Login berhasil (mengembalikan access token)
        "401":
          description: Kredensial salah

  /auth/me:
    get:
      summary: Mendapatkan data user saat ini
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Data user
        "401":
          description: Token tidak valid

  /users/{userId}/metrics:
    get:
      summary: Melihat metrics user (10 fitur belajar)
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: Metrics ditemukan
          content:
            application/json:
              example:
                total_materi_selesai: 1773
                avg_durasi_materi_detik: 5914.252115
                total_review: 442
                total_hari_aktif: 111
                std_dev_materi_harian: 22.99129558
                avg_skor_kuis: 71.45833333
                pass_rate_kuis: 0.5982142857
                total_kuis_diambil: 336
                avg_rating_submission: 2.25862069
                total_submissions: 58
                last_calculated_at: "2025-11-10T23:23:16.146Z"
        "404":
          description: Metrics belum tersedia

    put:
      summary: Membuat / update metrics secara manual
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            example:
              total_materi_selesai: 12
              avg_durasi_materi_detik: 320.5
              total_review: 5
              total_hari_aktif: 7
              std_dev_materi_harian: 1.2
              avg_skor_kuis: 82.5
              pass_rate_kuis: 0.8
              total_kuis_diambil: 4
              avg_rating_submission: 4.3
              total_submissions: 3
      responses:
        "200":
          description: Metrics berhasil diperbarui
        "400":
          description: Bad Request

  /users/{userId}/insights:
    post:
      summary: Meminta prediksi insight baru via ML service
      description: >
        Backend otomatis memanggil ML service untuk:
        - menghitung fitur belajar dari data,
        - menentukan gaya belajar (learning_style),
        - menyimpan metrics, insight terkini, dan history.
        Tidak perlu mengirim body.
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: Insight berhasil diproses
          content:
            application/json:
              example:
                student_id: 938276
                learning_style: "Fast Learner"
                confidence_score: 0.87
                name: "Nur Rizki Adi Prasetyo"
        "404":
          description: User tidak ditemukan

    get:
      summary: Mendapatkan insight terbaru user
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: Insight ditemukan
          content:
            application/json:
              example:
                student_id: 938276
                learning_style: "Fast Learner"
                confidence_score: 0.87
                updated_at: "2025-11-10T23:23:16.146Z"
        "404":
          description: Insight belum tersedia

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT